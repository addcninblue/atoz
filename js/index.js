// Generated by CoffeeScript 1.12.2
(function() {
  var advanceChar, clockRunning, computeWPM, fastestTime, original, reset, start, started, stop, stoppedDuration, timeBegan, timeStopped, typedLetters, typedWrongLetters;

  typedLetters = 0;

  typedWrongLetters = 0;

  original = '<span id="a">a</span><span id="b">b</span><span id="c">c</span><span id="d">d</span><span id="e">e</span><span id="f">f</span><span id="g">g</span><span id="h">h</span><span id="i">i</span><span id="j">j</span><span id="k">k</span><span id="l">l</span><span id="m">m</span><span id="n">n</span><span id="o">o</span><span id="p">p</span><span id="q">q</span><span id="r">r</span><span id="s">s</span><span id="t">t</span><span id="u">u</span><span id="v">v</span><span id="w">w</span><span id="x">x</span><span id="y">y</span><span id="z">z</span>';

  if ((Cookies.get("time") != null)) {
    fastestTime = Cookies.get("time");
  } else {
    fastestTime = "";
  }

  advanceChar = function(char) {
    var id, nextCharacter;
    nextCharacter = String.fromCharCode(char);
    id = "#" + String.fromCharCode(typedLetters + typedWrongLetters + 97);
    if (char - 97 === typedLetters + typedWrongLetters) {
      typedLetters++;
      $(id).addClass("correct");
    } else {
      typedWrongLetters++;
      $(id).addClass("wrong");
    }
    if (typedLetters === 26) {
      stop();
      if (fastestTime.length !== 0) {
        fastestTime = Math.min(fastestTime, $("#time").text());
      } else {
        fastestTime = $("#time").text();
      }
      document.cookie = "time=" + fastestTime;
      $("#fastestTime").text(fastestTime);
    }
    return $("#speed").text(computeWPM());
  };

  $(document).keypress(function(e) {
    if (e.which === 13) {
      return reset();
    } else if (typedLetters + typedWrongLetters === 26) {

    } else {
      if (typedLetters === 0) {
        reset();
        start();
      }
      return advanceChar(e.which);
    }
  });

  $(document).keydown(function(e) {
    var idprev;
    if (e.keyCode === 8) {
      idprev = "#" + String.fromCharCode(typedLetters + typedWrongLetters + 96);
      if ($(idprev).hasClass("correct")) {
        $(idprev).removeClass("correct");
        return typedLetters--;
      } else if ($(idprev).hasClass("wrong")) {
        $(idprev).removeClass("wrong");
        return typedWrongLetters--;
      }
    }
  });

  $(function() {
    $("#reset").click(function() {
      return reset();
    });
    if (fastestTime.length === 0) {
      $("#fastestTime").text(0);
    } else {
      $("#fastestTime").text(fastestTime);
    }
    if (Cookies.get("cookieUserConsent") !== "true") {
      return $("#cookies").css("visibility", "visible");
    }
  });

  timeBegan = null;

  timeStopped = null;

  stoppedDuration = 0;

  started = null;

  start = function() {
    if (timeBegan === null) {
      timeBegan = new Date();
    }
    if (timeStopped !== null) {
      stoppedDuration += new Date() - timeStopped;
    }
    return started = setInterval(clockRunning, 1);
  };

  stop = function() {
    timeStopped = new Date();
    return clearInterval(started);
  };

  clockRunning = function() {
    var currentTime, ms, sec, timeElapsed;
    currentTime = new Date();
    timeElapsed = new Date(currentTime - timeBegan - stoppedDuration);
    sec = timeElapsed.getUTCSeconds();
    ms = timeElapsed.getUTCMilliseconds();
    return $("#time").text(sec + "." + ms);
  };

  reset = function() {
    console.log("resetted");
    $("#typeHere").html(original);
    typedLetters = 0;
    typedWrongLetters = 0;
    clearInterval(started);
    stoppedDuration = 0;
    timeBegan = null;
    return timeStopped = null;
  };

  computeWPM = function() {
    var currentTime, wpm;
    currentTime = new Date();
    wpm = Math.floor(typedLetters * 1000 * 60 / (5 * new Date(currentTime - timeBegan)));
    return Math.min(400, wpm);
  };

  this.hideCookies = function() {
    Cookies.set("cookieUserConsent", "true");
    return $("#cookies").fadeOut();
  };

}).call(this);
